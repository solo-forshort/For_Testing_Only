<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mobile Money Security Q&A</title>
  <style>
    :root{
      --bg: #f5f7fa;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --border: #e5e7eb;
      --accent: #2563eb;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 24px;
      background: var(--bg);
      font-family: sans-serif;
      color: var(--text);
    }
    header {
      max-width: 900px;
      margin: 0 auto 12px;
      text-align: center;
    }
    h1 {
      margin: 0;
      font-size: 28px;
    }
    p.sub {
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 14px;
    }
    .controls {
      max-width: 900px;
      margin: 16px auto 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    .controls input,
    .controls select {
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #fff;
      font-size: 14px;
    }
    .controls button {
      padding: 10px 14px;
      border-radius: 10px;
      border: none;
      background: var(--accent);
      color: #fff;
      cursor: pointer;
      font-size: 14px;
    }
    .controls button:hover {
      filter: brightness(0.95);
    }
    #cards {
      max-width: 900px;
      margin: 0 auto;
      display: grid;
      gap: 14px;
      grid-template-columns: 1fr;
    }
    @media(min-width:720px) { #cards { grid-template-columns: 1fr 1fr; } }
    @media(min-width:1100px) { #cards { grid-template-columns: 1fr 1fr 1fr; } }
    .card {
      background: var(--card);
      border-radius: 12px;
      padding: 14px;
      border: 1px solid var(--border);
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      transition: transform 0.2s, box-shadow 0.2s;
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-height: 140px;
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.08);
    }
    .badges {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
    .badge {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #fff;
      color: var(--muted);
    }
    .priority.High { background: #ef4444; color: #fff; border-color: #ef4444; }
    .priority.Medium { background: #f59e0b; color: #111; border-color: #f59e0b; }
    .priority.Low { background: #22c55e; color: #fff; border-color: #22c55e; }
    .tag-badge {
      background: #eef4ff;
      color: #1e3a8a;
      border-color: #dbe6ff;
      font-weight: 600;
    }
    .q {
      font-size: 16px;
      font-weight: 700;
      margin: 0;
      color: var(--text);
    }
    .row {
      font-size: 14px;
      color: #374151;
    }
    .notes {
      font-size: 13px;
      color: #374151;
      background: #f3f4f6;
      border: 1px dashed var(--border);
      padding: 8px;
      border-radius: 8px;
    }
    .smalllink {
      color: var(--accent);
      text-decoration: none;
    }
    .empty {
      max-width: 900px;
      margin: 40px auto;
      text-align: center;
      color: var(--muted);
    }
    .loading {
      max-width: 900px;
      margin: 30px auto;
      text-align: center;
      color: var(--muted);
      font-style: italic;
    }
    footer {
      max-width: 900px;
      margin: 18px auto 0;
      text-align: center;
      color: var(--muted);
      font-size: 13px;
    }
  </style>
</head>
<body>

<header>
  <h1>Mobile Money Security Q&A</h1>
  <p class="sub">Live vendor questions & tips — automatically synced from your Google Sheet.</p>
</header>

<div class="controls">
  <input id="search" type="search" placeholder="Search by keyword… (e.g., fake transaction, PIN)">
  <select id="priorityFilter">
    <option value="">All Priorities</option>
    <option value="High">High</option>
    <option value="Medium">Medium</option>
    <option value="Low">Low</option>
  </select>
  <button id="askBtn">Ask a Question</button>
</div>

<div id="cards"></div>
<div id="empty" class="empty" style="display:none;">No items match your search or filters.</div>
<div id="loading" class="loading">Loading data…</div>

<footer>New responses appear automatically after submission.</footer>

<script>
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vToqPBwRgOnC8tq-xQ18vrCTtAL5v0TG2z7HoXdGiXTtLoilWkpfoq3DFWr93oPSXlsW2f_kmJ2Vse4/pub?output=csv";
  const FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSc4S6LV8NWwomzoGudHhDoAdwbQUblw3jOjVmvk4l6275Voeg/viewform?usp=sharing";
  const state = { all: [], filtered: [] };

  document.getElementById("askBtn").addEventListener("click", () => window.open(FORM_URL, "_blank", "noopener"));

  function parseCSV(text){
    text = text.replace(/\r\n/g,"\n").replace(/\r/g,"\n");
    const lines = text.split("\n").filter(l => l.trim() !== "");
    if (!lines.length) return [];
    const headers = lines[0].split(',').map(h => h.replace(/^"|"$/g,"").trim());
    return lines.slice(1).map(line => {
      const cells = line.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g) || [];
      const obj = {};
      headers.forEach((h,i) => obj[h] = (cells[i]||"").replace(/^"|"$/g,"").trim());
      return obj;
    });
  }

  function escapeHtml(s){return String(s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");}
  function render(){
    const cards = document.getElementById("cards");
    const empty = document.getElementById("empty");
    cards.innerHTML = "";

    if (!state.filtered.length){
      empty.style.display = "block";
      return;
    }
    empty.style.display = "none";

    state.filtered.forEach(it => {
      const card = document.createElement("article");
      card.className = "card";
      card.innerHTML = `
        <div class="badges">
          ${it.Priority ? `<span class="badge priority ${escapeHtml(it.Priority)}">${escapeHtml(it.Priority)}</span>` : ""}
          ${it.Tag ? `<span class="badge tag-badge">${escapeHtml(it.Tag)}</span>` : ""}
        </div>
        <div class="q">${escapeHtml(it.Question)}</div>
        ${it["Possible Solution"] ? `<div class="notes"><strong>Solution:</strong> ${escapeHtml(it["Possible Solution"])}</div>` : ""}
        ${it["Notes → any extra remarks"] ? `<div class="notes"><strong>Notes:</strong> ${escapeHtml(it["Notes → any extra remarks"])}</div>` : ""}
      `;
      cards.appendChild(card);
    });
  }

  function applyFilters(){
    const q = document.getElementById("search").value.toLowerCase();
    const p = document.getElementById("priorityFilter").value;
    state.filtered = state.all.filter(it => {
      const hay = [it.Question, it["Possible Solution"], it["Notes → any extra remarks"], it.Tag].join(" ").toLowerCase();
      return (!q || hay.includes(q)) && (!p || it.Priority === p);
    });
    render();
  }

  document.getElementById("search").addEventListener("input", applyFilters);
  document.getElementById("priorityFilter").addEventListener("change", applyFilters);

  (async() => {
    try {
      const res = await fetch(CSV_URL);
      const csv = await res.text();
      const rows = parseCSV(csv);
      state.all = rows.filter(r => r.Question && r.Question.trim() !== "");
      state.filtered = [...state.all];
      render();
    } catch(e){
      console.error("Error:", e);
      document.getElementById("empty").textContent = "Failed to load sheet data.";
      document.getElementById("empty").style.display = "block";
    } finally {
      document.getElementById("loading").style.display = "none";
    }
  })();
</script>
</body>
</html>
