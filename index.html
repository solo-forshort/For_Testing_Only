<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>MoMo Security Q&A</title>
  <style>
    body { margin:0; padding:24px; background:#f5f7fa; font-family:sans-serif; color:#111827; }
    header { max-width:900px; margin:0 auto 16px; text-align:center; }
    h1 { margin:0; font-size:28px; }
    p.sub { margin:6px 0 0; color:#6b7280; font-size:14px; }
    .ask-btn { display:inline-block; margin-top:14px; padding:10px 16px; border-radius:10px; background:#16a34a; color:#fff; font-size:14px; font-weight:600; text-decoration:none; transition:background .2s,transform .2s; }
    .ask-btn:hover { background:#15803d; transform:translateY(-2px); }
    .controls { max-width:900px; margin:16px auto 20px; display:flex; flex-wrap:wrap; gap:10px; justify-content:center; }
    .controls input, .controls select { padding:10px 12px; border:1px solid #e5e7eb; border-radius:10px; background:#fff; font-size:14px; }
    #cards { max-width:900px; margin:0 auto; display:grid; gap:14px; grid-template-columns:1fr; }
    @media(min-width:720px){ #cards{ grid-template-columns:1fr 1fr; } }
    @media(min-width:1100px){ #cards{ grid-template-columns:1fr 1fr 1fr; } }
    .card { background:#fff; border-radius:12px; padding:14px; border:1px solid #e5e7eb; box-shadow:0 2px 8px rgba(0,0,0,0.04); transition:transform .2s,box-shadow .2s; display:flex; flex-direction:column; gap:8px; min-height:180px; }
    .card:hover { transform:translateY(-4px); box-shadow:0 12px 24px rgba(0,0,0,0.08); }
    .badges { display:flex; gap:6px; flex-wrap:wrap; }
    .badge { font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid #e5e7eb; background:#fff; color:#6b7280; }
    .priority.High{background:#ef4444;color:#fff;border-color:#ef4444;}
    .priority.Medium{background:#f59e0b;color:#111;border-color:#f59e0b;}
    .priority.Low{background:#22c55e;color:#fff;border-color:#22c55e;}
    .tag-badge{background:#eef4ff;color:#1e3a8a;border-color:#dbe6ff;font-weight:600;}
    .q{font-size:16px;font-weight:700;margin:0;color:#111827;}
    .row{font-size:14px;color:#374151;}
    .notes{font-size:13px;color:#374151;background:#f3f4f6;border:1px dashed #e5e7eb;padding:8px;border-radius:8px;}
    .suggest-area { margin-top:8px; }
    .suggest-area textarea { width:100%; height:60px; padding:6px; font-size:14px; border:1px solid #ccc; border-radius:6px; resize:vertical; }
    .suggest-area button { margin-top:6px; padding:6px 12px; border:none; border-radius:8px; background:#2563eb; color:#fff; font-size:13px; cursor:pointer; transition:background .2s; }
    .suggest-area button:hover { background:#1d4ed8; }
    .empty{max-width:900px;margin:40px auto;text-align:center;color:#6b7280;}
    .loading{max-width:900px;margin:30px auto;text-align:center;color:#6b7280;font-style:italic;}
  </style>
</head>
<body>

<header>
  <h1>Mobile Money Security Q&A</h1>
  <p class="sub">Live questions synced from Google Sheets</p>
  <a href="https://docs.google.com/forms/d/e/1FAIpQLSc4S6LV8NWwomzoGudHhDoAdwbQUblw3jOjVmvk4l6275Voeg/viewform" target="_blank" class="ask-btn">Ask a Question</a>
</header>

<div class="controls">
  <input id="search" type="search" placeholder="Search keywordâ€¦">
  <select id="priorityFilter">
    <option value="">All Priorities</option>
    <option value="High">High</option>
    <option value="Medium">Medium</option>
    <option value="Low">Low</option>
  </select>
</div>

<div id="cards"></div>
<div id="empty" class="empty" style="display:none;">No matching cards</div>
<div id="loading" class="loading">Loading...</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vToqPBwRgOnC8tq-xQ18vrCTtAL5v0TG2z7HoXdGiXTtLoilWkpfoq3DFWr93oPSXlsW2f_kmJ2Vse4/pub?output=csv";
const FORM_PRE = "https://docs.google.com/forms/d/e/1FAIpQLSc4S6LV8NWwomzoGudHhDoAdwbQUblw3jOjVmvk4l6275Voeg/viewform?usp=pp_url&entry.1219669983=";
const SOL_ENTRY = "&entry.1293335924=";
const state = { all: [], filtered: [] };

function parseCSV(text){
  const lines = text.replace(/\r\n/g,"\n").split("\n").filter(l => l.trim());
  if(!lines.length) return [];
  const headers = lines.shift().split(',').map(h=>h.replace(/^"|"$/g,"").trim());
  return lines.map(l=>{const cells=l.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g)||[]; let o={}; headers.forEach((h,i)=>o[h]=(cells[i]||"").replace(/^"|"$/g,"").trim()); return o;});
}
function escape(s){return String(s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");}

function render(){
  const cards=document.getElementById("cards"),empty=document.getElementById("empty");
  cards.innerHTML="";
  if(!state.filtered.length){empty.style.display="block";return;} empty.style.display="none";
  state.filtered.forEach(it=>{
    const card = document.createElement("article"); card.className="card";
    const prefill = [it["Question 1"],it["Question 2"],it["Question 3"]].filter(Boolean).join(" | ");
    const formLink = FORM_PRE + encodeURIComponent(prefill) + SOL_ENTRY + "USER_SOLUTION";
    card.innerHTML = `
      <div class="badges">
        ${it["Priority(H/M/L)"]?`<span class="badge priority ${escape(it["Priority(H/M/L)"])}">${escape(it["Priority(H/M/L)"])}</span>`:""}
        ${it["Tag(e.g., SIM swap, phishing, PIN safety)."]?`<span class="badge tag-badge">${escape(it["Tag(e.g., SIM swap, phishing, PIN safety)."])}</span>`:""}
      </div>
      ${it["Question 1"]?`<div class="q"><strong>Q1:</strong> ${escape(it["Question 1"])}</div>`:""}
      ${it["Question 2"]?`<div class="row"><strong>Q2:</strong> ${escape(it["Question 2"])}</div>`:""}
      ${it["Question 3"]?`<div class="row"><strong>Q3:</strong> ${escape(it["Question 3"])}</div>`:""}
      ${it["Possible Solution"]?`<div class="notes"><strong>Solution:</strong> ${escape(it["Possible Solution"])}</div>`:""}
      <div class="suggest-area">
        <textarea placeholder="Your suggestion..."></textarea>
        <button onclick="submitSolution(this, '${formLink}')">Submit Solution</button>
      </div>`;
    cards.appendChild(card);
  });
}
function submitSolution(button, baseLink){
  const txt = button.previousElementSibling.value.trim();
  if(!txt){ alert("Type your suggestion first."); return; }
  const url = baseLink.replace("USER_SOLUTION", encodeURIComponent(txt));
  window.open(url,"_blank","noopener");
}

function applyFilters(){
  const q=document.getElementById("search").value.toLowerCase();
  const p=document.getElementById("priorityFilter").value;
  state.filtered = state.all.filter(it=>{
    const hay=[it["Question 1"],it["Question 2"],it["Question 3"],it["Tag(e.g., SIM swap, phishing, PIN safety)."]].join(" ").toLowerCase();
    return (!q||hay.includes(q))&&(!p||it["Priority(H/M/L)"]===p);
  });
  render();
}
document.getElementById("search").addEventListener("input",applyFilters);
document.getElementById("priorityFilter").addEventListener("change",applyFilters);

(async()=>{
  try{
    const r=await fetch(CSV_URL); const csv=await r.text();
    state.all=parseCSV(csv).filter(r=>r["Question 1"]&&r["Question 1"].trim());
    state.filtered=[...state.all];
    render();
  }catch(e){
    console.error(e);
    document.getElementById("empty").textContent="Could not load data.";
    document.getElementById("empty").style.display="block";
  }finally{
    document.getElementById("loading").style.display="none";
  }
})();
</script>
</body>
</html>
